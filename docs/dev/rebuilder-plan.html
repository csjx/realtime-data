

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Rebuilding instrument channel and archive data &mdash; Realtime Data 1.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Realtime Data 1.1.0 documentation" href="../index.html"/>
        <link rel="prev" title="1. User Guide" href="../user/user-guide.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Realtime Data
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/user-guide.html">1. User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/user-guide.html#managing-the-dataturbine-server-software">1.1. Managing the DataTurbine Server Software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#starting-the-dataturbine">1.1.1. Starting the DataTurbine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#stopping-the-dataturbine">1.1.2. Stopping the DataTurbine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#troubleshooting-the-dataturbine">1.1.3. Troubleshooting the DataTurbine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user/user-guide.html#managing-the-dataturbine-instrument-drivers">1.2. Managing the DataTurbine Instrument Drivers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#configuring-instrument-drivers">1.2.1. Configuring Instrument Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#starting-instrument-drivers">1.2.2. Starting Instrument Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#stopping-instrument-drivers">1.2.3. Stopping Instrument Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#starting-drivers-through-dispatchers">1.2.4. Starting Drivers through Dispatchers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user/user-guide.html#adam-module-engineering-data">1.2.4.1. ADAM Module engineering data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user/user-guide.html#stor-x-data-logger-data">1.2.4.2. STOR-X Data Logger data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#id1">1.2.5. Stopping Instrument Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#troubleshooting-instrument-drivers">1.2.6. Troubleshooting Instrument Drivers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user/user-guide.html#rebuilding-channel-data">1.3. Rebuilding Channel Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/user-guide.html#replicating-instrument-data-streams">1.4. Replicating Instrument Data Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/user-guide.html#managing-the-dataturbine-file-archivers">1.5. Managing the DataTurbine File Archivers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#starting-instrument-file-archivers">1.5.1. Starting Instrument File Archivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#stopping-instrument-archivers">1.5.2. Stopping Instrument Archivers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user/user-guide.html#understanding-file-based-replication">1.6. Understanding File-based replication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/user-guide.html#managing-the-matlab-instrument-plotting-code">1.7. Managing the Matlab Instrument Plotting Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#connecting-to-the-server-via-vnc">1.7.1. Connecting to the Server via VNC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#starting-the-instrument-plotting-code">1.7.2. Starting the Instrument Plotting Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#stopping-the-instrument-plotting-code">1.7.3. Stopping the Instrument Plotting Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/user-guide.html#viewing-instrument-plots">1.7.4. Viewing Instrument Plots</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">2. Rebuilding instrument channel and archive data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#rebuild-sequence-diagram">2.1. Rebuild Sequence Diagram</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Realtime Data</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>2. Rebuilding instrument channel and archive data</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/dev/rebuilder-plan.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="rebuilding-instrument-channel-and-archive-data">
<h1>2. Rebuilding instrument channel and archive data<a class="headerlink" href="#rebuilding-instrument-channel-and-archive-data" title="Permalink to this headline">¶</a></h1>
<p>We periodically need to recreate channel data and archive files due to gaps in the data caused by network communication drops, stopped drivers, server maintenance, etc.  This is enabled using the <code class="docutils literal"><span class="pre">manage-instruments</span></code> script with a <code class="docutils literal"><span class="pre">rebuilder</span></code> command.  This document outlines the workflow based on that command.</p>
<div class="section" id="rebuild-sequence-diagram">
<h2>2.1. Rebuild Sequence Diagram<a class="headerlink" href="#rebuild-sequence-diagram" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/rebuild-workflow.png" src="../_images/rebuild-workflow.png" />
<p>The technician downloads data from an instrument flash card and saves it as a text file on <code class="docutils literal"><span class="pre">realtime.pacioos.hawaii.edu</span></code>.  They then use the <code class="docutils literal"><span class="pre">manage-instruments</span></code> script to stop the instrument driver and archiver so there&#8217;s no activity for the Data Turbine channel and the disk archive directory for the given instrument.</p>
<p>Once the realtime data and archiving is paused, the technician uses the <code class="docutils literal"><span class="pre">manage-instruments</span></code> script to rebuild the archive by providing the instrument identifier and the text file of the downloaded data.  The script will spin up a <code class="docutils literal"><span class="pre">TextRebuildApp</span></code> that parses the instrument configuration file, loads the raw text data, sorts it based on the data timestamps, and deduplicates any repeat sample lines.  Once complete, it gets the earliest and latest timestamps in the text file to establish the range of dates that need to be rebuilt in the disk archive and in the Data Turbine.</p>
<p>It then finds the files in the disk raw archive directory within that time range, and appends the archived data to the already loaded raw data.  Likewise, it fetches the raw data for the given time range from the Data Turbine and appends it as well.</p>
<p>With all possible sources of raw data, the <code class="docutils literal"><span class="pre">TextRebuildApp</span></code> then sorts and and de-duplicates the data again, creating a rebuilt raw product.  This is then written to the raw disk archive after deleting existing files in the time range.  It then clears the Data Turbine raw channel, and repopulates that channel with the rebuilt data.</p>
<p>After the raw files data are rebuilt, the <code class="docutils literal"><span class="pre">TextRebuildApp</span></code> uses the <code class="docutils literal"><span class="pre">RawToPacIOOS2020Coverter</span></code> to convert the data to the new format.  It then deletes the converted disk archive files for the time range, and re-populates the converted Data Turbine channel for the instrument.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../user/user-guide.html" class="btn btn-neutral" title="1. User Guide" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Regents of the University of Hawaii. All rights reserved.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>